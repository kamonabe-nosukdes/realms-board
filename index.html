<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>レルム掲示板</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#3b3b3b;
  background-image:
    linear-gradient(90deg,#4a4a4a 25%,transparent 25%),
    linear-gradient(#4a4a4a 25%,transparent 25%);
  background-size:80px 80px;
  color:#fff;
}

.container{
  max-width:600px;
  margin:40px auto;
  padding:20px;
  background:rgba(0,0,0,0.7);
  border:4px solid #2b2b2b;
  border-radius:8px;
}

input, textarea{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:none;
  border-radius:4px;
}

button{
  width:100%;
  padding:10px;
  background:#7c7c7c;
  color:#fff;
  border:none;
  cursor:pointer;
  font-weight:bold;
}

.post{
  background:#2f2f2f;
  padding:10px;
  margin-top:10px;
  border-left:5px solid #8b8b8b;
}
.name{
  font-weight:bold;
  color:#bdbdbd;
}
</style>
</head>
<body>

<div class="container">
  <h1>レルム掲示板</h1>
  <input type="text" id="nickname" placeholder="ニックネーム">
  <textarea id="message" rows="4" placeholder="内容を書く..."></textarea>
  <button onclick="postMessage()">投稿</button>
  <div id="posts"></div>
</div>

<script>
const supabase = window.supabase.createClient(
  "sb_publishable_FjgdGs2efgUSiLkROey7ng_pUQpM-Os",
  "sb_secret_fCsGGtwiF_muZM3HAHJucA_RXFC3eU2"
);

const nicknameInput = document.getElementById("nickname");
nicknameInput.value = localStorage.getItem("nickname") || "";

nicknameInput.addEventListener("input", () => {
  localStorage.setItem("nickname", nicknameInput.value);
});

async function loadPosts(){
  const { data } = await supabase
    .from("posts")
    .select("*")
    .order("created_at", { ascending: false });

  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML = "";

  data.forEach(post=>{
    const div=document.createElement("div");
    div.className="post";
    div.innerHTML=`
      <div class="name">${post.name}</div>
      <div>${post.message}</div>
    `;
    postsDiv.appendChild(div);
  });
}

async function postMessage(){
  const name = nicknameInput.value.trim();
  const message = document.getElementById("message").value.trim();
  if(!name || !message) return;

  await supabase.from("posts").insert([{ name, message }]);
  document.getElementById("message").value="";
  loadPosts();
}

loadPosts();
</script>

</body>
</html>
